```html
<!-- filepath: /Users/rraviku2/develop/cloud-asset-inventory/diagrams/ui/docs/uswithcomments.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Service Based Launchpad - User Stories & BDD Acceptance Criteria (With Comments)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="User stories & BDD acceptance criteria for Service Based Launchpad (comment-enabled)">
<style>
/* THEME (matches userstories.html) */
:root{
  --bg:#f6f8fa;
  --panel:#ffffff;
  --panel-alt:#f5f9fc;
  --border:#d9e2ea;
  --border-soft:#dce5eb;
  --text:#1a2330;
  --muted:#5a6c7a;
  --accent:#0b63c7;
  --accent-hover:#084d9b;
  --highlight:#ffe29c;
  --radius:14px;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  color-scheme:light;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  line-height:1.45;
  padding:1.5rem;
  max-width:1500px;
  margin-inline:auto;
}

/* Top toolbar */
.top-bar{display:flex;flex-wrap:wrap;gap:.9rem;align-items:center;margin:0 0 1.4rem;}
.top-bar h1{flex:1 1 420px;margin:0;font-size:1.9rem;line-height:1.15;}

.comments-toolbar{
  display:flex;
  flex-wrap:wrap;
  gap:.55rem;
  align-items:center;
  font-size:.62rem;
}
.comments-toolbar button,
.comments-toolbar label.import-btn{
  border:1px solid var(--accent);
  background:var(--accent);
  color:#fff;
  font-weight:600;
  letter-spacing:.05em;
  padding:.55rem .9rem;
  border-radius:9px;
  cursor:pointer;
  font-size:.62rem;
  text-transform:uppercase;
  display:inline-flex;
  align-items:center;
  gap:.4rem;
}
.comments-toolbar button:hover,
.comments-toolbar label.import-btn:hover{background:var(--accent-hover);border-color:var(--accent-hover);}
.comments-toolbar input[type=file]{display:none;}
#comments-status{font-size:.6rem;color:var(--muted);min-width:160px;}
.export-hint{font-size:.55rem;color:var(--muted);margin-left:.15rem;font-style:italic;}

/* THREE COLUMN GRID */
.grid{
  display:grid;
  gap:1.1rem;
  grid-template-columns:repeat(3,1fr);
  align-items:start;
}
@media (max-width:1200px){
  .grid{grid-template-columns:repeat(2,1fr);}
}
@media (max-width:780px){
  .grid{grid-template-columns:1fr;}
}

.story{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:1rem 1.15rem 1.05rem;
  box-shadow:0 3px 8px -3px rgba(0,0,0,.08);
  display:flex;
  flex-direction:column;
  gap:.6rem;
  position:relative;
  min-width:0;
}

.story h2{
  margin:0;
  font-size:1rem;
  display:flex;
  justify-content:space-between;
  gap:.75rem;
  align-items:flex-start;
  line-height:1.25;
}

.tagline{
  font-size:.72rem;
  color:#475867;
  font-weight:600;
  letter-spacing:.05em;
  text-transform:uppercase;
  background:#e6eef4;
  padding:2px 8px;
  border-radius:20px;
  flex:0 0 auto;
  white-space:nowrap;
}

.meta{
  font-size:.62rem;
  color:var(--muted);
  display:flex;
  flex-wrap:wrap;
  gap:.6rem;
}
.meta span{
  background:#eef3f7;
  padding:3px 7px;
  border-radius:8px;
  font-weight:600;
  letter-spacing:.04em;
}

.desc{margin:0;font-size:.8rem;}

/* Highlight */
::selection{background:var(--highlight);color:#362400;}
::-moz-selection{background:var(--highlight);color:#362400;}
mark,.hl{background:var(--highlight);color:#362400;padding:0 3px;border-radius:4px;}

ul.scenarios{
  list-style:none;
  margin:.2rem 0 0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:.55rem;
  font-size:.72rem;
}
ul.scenarios li{
  background:var(--panel-alt);
  border:1px solid var(--border-soft);
  padding:.55rem .65rem;
  border-radius:10px;
  position:relative;
}
code.inline{
  background:#eef3f7;
  padding:1px 5px;
  border-radius:5px;
  font-size:.72rem;
}
.gwt{
  white-space:pre-line;
  font-family:ui-monospace,Menlo,Consolas,monospace;
  font-size:.68rem;
  background:#232f3a;
  color:#f1f5f8;
  border-radius:8px;
  padding:.6rem .75rem .7rem;
  margin:.5rem 0 0;
  overflow:auto;
  line-height:1.35;
}

.group-title{margin:2.2rem 0 .4rem;font-size:1.15rem;border-bottom:2px solid #d3dee6;padding-bottom:.35rem;}
.legend{font-size:.62rem;margin:1.4rem 0 0;color:#4b5d6b;}

/* Comments */
.comments-block{
  margin:.35rem 0 0;
  padding:.75rem .85rem .85rem;
  border:1px solid var(--border-soft);
  border-radius:12px;
  background:var(--panel-alt);
  display:flex;
  flex-direction:column;
  gap:.6rem;
}
.comments-block h3{
  margin:0;
  font-size:.65rem;
  letter-spacing:.06em;
  text-transform:uppercase;
  color:var(--muted);
  font-weight:700;
  display:flex;
  align-items:center;
  gap:.55rem;
}
.comments-block h3 span[data-count]{
  background:var(--accent);
  color:#fff;
  padding:2px 9px;
  font-size:.55rem;
  border-radius:999px;
  font-weight:600;
  min-width:26px;
  text-align:center;
}
.comment-form{display:flex;flex-direction:column;gap:.5rem;}
.comment-form label{
  font-size:.55rem;
  font-weight:600;
  letter-spacing:.05em;
  text-transform:uppercase;
  color:var(--muted);
  display:flex;
  flex-direction:column;
  gap:.4rem;
}

.comment-form textarea{
  resize:vertical;
  min-height:72px;
  font-family:inherit;
  font-size:.7rem;
  line-height:1.45;
  padding:.65rem .7rem;
  border:1px solid var(--border);
  border-radius:8px;
  background:#fff;
  color:#102a3b;
  font-weight:700;
  -webkit-text-fill-color:#102a3b;
  caret-color:var(--accent);
  box-shadow:0 2px 4px -2px rgba(0,0,0,.06) inset;
}
.comment-form textarea::placeholder{color:var(--muted);opacity:.75;font-weight:500;}
.comment-form textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(11,99,199,.28);
  background:#ffffff;
}

.comment-form button{
  align-self:flex-start;
  background:var(--accent);
  color:#fff;
  border:1px solid var(--accent);
  padding:.48rem .9rem;
  font-size:.58rem;
  font-weight:600;
  letter-spacing:.05em;
  border-radius:7px;
  cursor:pointer;
  text-transform:uppercase;
}
.comment-form button:hover{background:var(--accent-hover);border-color:var(--accent-hover);}
.comment-form button:disabled{opacity:.55;cursor:not-allowed;}

.comment-list{
  list-style:none;
  margin:0;
  padding:0;
  display:flex;
  flex-direction:column;
  gap:.55rem;
  font-size:.66rem;
  max-height:210px;
  overflow:auto;
}

.comment-item{
  background:#eef3f7;
  border:1px solid #d3dfe7;
  padding:.55rem .65rem .6rem;
  border-radius:8px;
  position:relative;
  display:flex;
  flex-direction:column;
  gap:.4rem;
  box-shadow:0 1px 3px -2px rgba(0,0,0,.12);
}
.comment-item div{
  font-weight:700;
  color:#102a3b;
  line-height:1.3;
  word-break:break-word;
}
.comment-item time{
  font-size:.5rem;
  letter-spacing:.05em;
  text-transform:uppercase;
  color:var(--muted);
}
.comment-item button[data-del]{
  position:absolute;
  top:4px;
  right:4px;
  background:#c7433d;
  border:1px solid #c7433d;
  color:#fff;
  width:20px;
  height:20px;
  line-height:1;
  font-size:.6rem;
  font-weight:700;
  border-radius:5px;
  cursor:pointer;
}
.comment-item button[data-del]:hover{background:#a93430;}
.empty-comments{font-size:.58rem;color:var(--muted);font-style:italic;}
.hint-line{font-size:.5rem;color:var(--muted);font-style:italic;letter-spacing:.04em;}

.visually-hidden{
  position:absolute!important;
  width:1px;height:1px;
  padding:0;margin:0;
  clip:rect(1px,1px,1px,1px);
  clip-path:inset(50%);
  overflow:hidden;
  white-space:nowrap;
  border:0;
}

@media (max-width:780px){
  h1{font-size:1.55rem;}
  .story{padding:.9rem 1rem;}
  .gwt{font-size:.65rem;}
}
</style>
</head>
<body>
  <div class="top-bar">
    <h1>Service Based Launchpad – User Stories & BDD Acceptance Criteria</h1>
    <div class="comments-toolbar" aria-label="Global comments actions">
      <button id="export-comments" type="button">Export JSON</button>
      <label class="import-btn" for="import-comments">Import
        <input id="import-comments" type="file" accept="application/json">
      </label>
      <span id="comments-status" aria-live="polite"></span>
      <span class="export-hint">Exports local comments (commit JSON beside this file).</span>
    </div>
  </div>

  <noscript style="color:#c7433d;font-size:.8rem;font-weight:600;">
    JavaScript required for interactive comments and persistence.
  </noscript>

  <div class="grid">
    <!-- STORY 1 -->
    <div class="story" id="US-01" data-story-id="US-01">
      <h2><span>US-01 Render Service List for Tenant and all its Accounts</span><span class="tagline">Listing Services</span></h2>
      <p class="desc">As a user I want to see a list of all SBL Services for the Tenant and its Accounts so I can enable them to be deployed.</p>
      <div class="meta"><span>Actors: Admin, Read Only</span><span>Priority: High</span><span>State: To Be Implemented</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Enabling SBL for Tenant</strong>
          <div class="gwt">Given I am Role "Admin"
When I Navigate to “Service Based launchpad”
Then I should have an option to Enable SBL Services on the Tenant</div>
        </li>
        <li>
          <strong>Scenario: Render Service List for Tenant</strong>
          <div class="gwt">Given I am Role “Admin”
When I Navigate to the “Service Based Launchpad” Menu
And SBL is enabled
Then I should be able to see a list of all Services for the Tenant and its Accounts</div>
        </li>
        <li>
          <strong>Scenario: <mark>I am Read Only Role - Should I see the list if Admin has already enabled?</mark></strong>
          <div class="gwt">Given I am Role “Read Only”
When I Navigate to the “Service Based Launchpad” Menu
Then I should not be able to Enable SBL Services for the Tenant
And <mark>what should display??? Should I still be able to see services if an Admin user has enabled</mark></div>
        </li>
      </ul>
    </div>

    <!-- STORY 2 -->
    <div class="story" id="US-02" data-story-id="US-02">
      <h2><span>US-02 Enable Column Conditional Visibility</span><span class="tagline">Authorization</span></h2>
      <p class="desc">As an Admin of a partially managed or unmanaged tenant I want to see the Enable column so I can stage activation changes.</p>
      <div class="meta"><span>Actors: Admin</span><span>Priority: High</span><span>Rule: Admin AND (Partially/Unmanaged)</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Enable column visible for Admin + Partially Managed</strong>
          <div class="gwt">Given I am Role "Admin"
And Tenant Type is "Partially Managed"
When the service list renders
Then the Enable column is present
And each row includes a toggle control</div>
        </li>
        <li>
          <strong>Scenario: Enable column hidden for Admin + Managed</strong>
          <div class="gwt">Given I am Role "Admin"
And Tenant Type is "Managed"
When the service list renders
Then the Enable column is not rendered
And layout grid collapses without empty space</div>
        </li>
        <li>
          <strong>Scenario: Enable column hidden for Read Only regardless of tenant</strong>
          <div class="gwt">Given I am Role "Read Only"
And Tenant Type is "Unmanaged"
When the service list renders
Then the Enable column is not rendered</div>
        </li>
      </ul>
    </div>

    <!-- STORY 3 -->
    <div class="story" id="US-03" data-story-id="US-03">
      <h2><span>US-03 Staging Changes & Submit Activation</span><span class="tagline">Change Tracking</span></h2>
      <p class="desc">As an Admin I want the Submit button enabled only when I have staged enable-state changes.</p>
      <div class="meta"><span>Actors: Admin</span><span>Priority: High</span><span>Baseline vs Working Set</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Submit disabled on initial load</strong>
          <div class="gwt">Given dataset just loaded
And no toggles changed
When the UI renders
Then the Submit button is disabled</div>
        </li>
        <li>
          <strong>Scenario: Submit enabled after a toggle change</strong>
          <div class="gwt">Given I changed a service enable state
When change tracking runs
Then Submit becomes enabled
And aria-disabled equals "false"</div>
        </li>
        <li>
          <strong>Scenario: Submit re-disables after submitting</strong>
          <div class="gwt">Given staged changes exist
When I click Submit
Then baseline updates to current states
And Submit becomes disabled again</div>
        </li>
      </ul>
    </div>

    <!-- STORY 4 -->
    <div class="story" id="US-04" data-story-id="US-04">
      <h2><span>US-04 Discard Confirmation on Context Change</span><span class="tagline">Safety</span></h2>
      <p class="desc">As an Admin I want to be warned before losing unsaved staged changes when I navigate away from the screen.</p>
      <div class="meta"><span>Actors: Admin</span><span>Priority: High</span><span>State: To Be Implemented</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Prompt shown with pending changes (tenant)</strong>
          <div class="gwt">Given I have staged changes
When I Navigate Away
Then a confirmation dialog appears
And selecting Cancel keeps me in the Screen</div>
        </li>
        <li>
          <strong>Scenario: No prompt with no staged changes</strong>
          <div class="gwt">Given there are no staged changes
When I change Role
Then no confirmation dialog appears</div>
        </li>
      </ul>
    </div>

    <!-- STORY 5 -->
    <div class="story" id="US-05" data-story-id="US-05">
      <h2><span>US-05 Full Text Search with Highlight</span><span class="tagline">Filtering</span></h2>
      <p class="desc">As a user I want to search services by name or description and see matching fragments highlighted.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: High</span><span>Debounce: 160ms</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Highlight matches in name</strong>
          <div class="gwt">Given I type a query that matches part of a service name
When results render
Then matching text segments are wrapped in a span.highlight</div>
        </li>
        <li>
          <strong>Scenario: Case-insensitive description match</strong>
          <div class="gwt">Given query = "service"
When a description contains "Service" (mixed case)
Then the service is included
And the matched fragment is highlighted</div>
        </li>
        <li>
          <strong>Scenario: Empty query clears highlights</strong>
          <div class="gwt">Given I clear the search box
When the filter reapplies
Then no highlight spans remain</div>
        </li>
      </ul>
    </div>

    <!-- STORY 6 -->
    <div class="story" id="US-06" data-story-id="US-06">
      <h2><span>US-06 Status Filter (Active / Inactive)</span><span class="tagline">Filtering</span></h2>
      <p class="desc">As a user I want to filter the list by active state to narrow visible services.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Medium</span><span>Persisted</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Active filter shows only active</strong>
          <div class="gwt">Given I select "Active" in the status filter
When filtering runs
Then only services with active=true appear
And counts reflect filtered subset</div>
        </li>
        <li>
          <strong>Scenario: Reset to all statuses</strong>
          <div class="gwt">Given a filter is applied
When I choose "All Statuses"
Then previously hidden services reappear</div>
        </li>
      </ul>
    </div>

    <!-- STORY 7 -->
    <div class="story" id="US-07" data-story-id="US-07">
      <h2><span>US-07 Sort Modes with Persistence</span><span class="tagline">Sorting</span></h2>
      <p class="desc">As a user I want to sort services by name, status, or recency and have the choice persist across reloads.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Medium</span><span>Modes: 5</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Sort by Recently Updated</strong>
          <div class="gwt">Given I select "Recently Updated"
When sorting runs
Then services are ordered by updated descending
And summary bar displays selected sort label</div>
        </li>
        <li>
          <strong>Scenario: Persisted sort after reload</strong>
          <div class="gwt">Given I previously selected "Status (Active first)"
When I reload the page
Then the sort dropdown value is "status-active-first"
And list order reflects that mode</div>
        </li>
      </ul>
    </div>

    <!-- STORY 8 -->
    <div class="story" id="US-08" data-story-id="US-08">
      <h2><span>US-08 Clear & Reset Controls</span><span class="tagline">Filtering UX</span></h2>
      <p class="desc">As a user I want quick buttons to clear filters or reset all filtering + sorting to defaults.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Medium</span><span>Buttons: Clear / Reset</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Clear removes query + status only</strong>
          <div class="gwt">Given I have a query and status filter
When I click Clear
Then query becomes empty
And status resets to "all"
And sort is unchanged</div>
        </li>
        <li>
          <strong>Scenario: Reset returns full defaults</strong>
          <div class="gwt">Given I changed query, status, and sort
When I click Reset
Then query is empty
And status = all
And sort = name-asc</div>
        </li>
      </ul>
    </div>

    <!-- STORY 9 -->
    <div class="story" id="US-09" data-story-id="US-09">
      <h2><span>US-09 Counts & Summary Bar</span><span class="tagline">Feedback</span></h2>
      <p class="desc">As a user I want live counts to understand the filtered subset in context of total inventory.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Medium</span><span>Live updates</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Counts reflect filtered list</strong>
          <div class="gwt">Given 10 total services
And I filter to 4 matches
When the list re-renders
Then visible/total shows 4/10</div>
        </li>
        <li>
          <strong>Scenario: Active and Inactive tallies remain global</strong>
          <div class="gwt">Given only a subset is visible
When counts update
Then Active and Inactive chips still reflect totals (not subset)</div>
        </li>
      </ul>
    </div>

    <!-- STORY 10 -->
    <div class="story" id="US-10" data-story-id="US-10">
      <h2><span>US-10 Active Filters Chips</span><span class="tagline">Filtering UX</span></h2>
      <p class="desc">As a user I want removable chips representing active filters & non-default sort to quickly clear them individually.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Medium</span><span>Chips: query status sort</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Sort chip appears when not default</strong>
          <div class="gwt">Given current sort = updated-desc
When chips render
Then a Sort chip displays the label of the sort mode</div>
        </li>
        <li>
          <strong>Scenario: Removing status chip resets filter</strong>
          <div class="gwt">Given statusSel = inactive
When I click × on Status chip
Then status filter resets to all
And services list expands</div>
        </li>
      </ul>
    </div>

    <!-- STORY 11 -->
    <div class="story" id="US-11" data-story-id="US-11">
      <h2><span>US-11 Accessible Time Representations</span><span class="tagline">A11y</span></h2>
      <p class="desc">As a user (including AT) I want both human-readable relative times and machine-readable timestamps.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Low</span><span>Tags: &lt;time&gt;</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Updated time includes ISO datetime attribute</strong>
          <div class="gwt">Given a service updated timestamp exists
When row renders
Then a time element has a datetime attribute in ISO format
And visible text shows a relative string (e.g. "8m ago")</div>
        </li>
        <li>
          <strong>Scenario: Last run only appears for deploy statuses Failed/Successful</strong>
          <div class="gwt">Given deployment status = "Successful"
When row renders
Then last run time block is visible
When deployment status = "" (empty)
Then last run block is absent</div>
        </li>
      </ul>
    </div>

    <!-- STORY 12 -->
    <div class="story" id="US-12" data-story-id="US-12">
      <h2><span>US-12 Empty State Messaging</span><span class="tagline">Feedback</span></h2>
      <p class="desc">As a user I want a clear empty state message when no services match filters.</p>
      <div class="meta"><span>Actors: All</span><span>Priority: Low</span><span>Single message</span></div>
      <ul class="scenarios">
        <li>
          <strong>Scenario: Empty hint displayed when list empty</strong>
          <div class="gwt">Given filters exclude all services
When render runs
Then the paragraph #empty-hint becomes visible
And list container is empty</div>
        </li>
        <li>
          <strong>Scenario: Empty hint hidden when results appear</strong>
          <div class="gwt">Given the empty hint is visible
When I remove the restrictive filter
Then empty hint is hidden
And services render</div>
        </li>
      </ul>
    </div>
  </div>

  <div id="comments-live" class="visually-hidden" aria-live="polite"></div>

<script>
/* Comment system */
(()=>{
  const STORAGE_KEY='sbl_story_comments_v1';
  const EXPORT_FILE='userstories-comments.json';
  let model={stories:{}};

  try{
    const raw=localStorage.getItem(STORAGE_KEY);
    if(raw){
      const parsed=JSON.parse(raw);
      if(parsed && typeof parsed==='object' && parsed.stories) model=parsed;
    }
  }catch(_e){}

  document.querySelectorAll('.story[data-story-id]').forEach(story=>{
    const id=story.getAttribute('data-story-id');
    if(!model.stories[id]) model.stories[id]=[];
    const block=document.createElement('section');
    block.className='comments-block';
    block.setAttribute('aria-labelledby',id+'-comments-title');
    block.innerHTML=`
      <h3 id="${id}-comments-title">Comments <span data-count="${id}">${model.stories[id].length}</span></h3>
      <ul class="comment-list" id="${id}-comment-list" aria-live="polite"></ul>
      <form class="comment-form" data-story="${id}">
        <label>New Comment
          <textarea name="comment" maxlength="1000" required aria-label="Add comment for story ${id}" placeholder="Add feedback or questions..."></textarea>
        </label>
        <div style="display:flex;align-items:center;gap:.65rem;flex-wrap:wrap;">
          <button type="submit">Add</button>
          <span class="hint-line">Stored locally; export JSON to persist to repo.</span>
        </div>
      </form>`;
    story.appendChild(block);
    renderList(id);
  });

  function escapeHTML(str){
    return str.replace(/[&<>"]/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch]));
  }
  function persist(){
    try{localStorage.setItem(STORAGE_KEY,JSON.stringify(model));}catch(_e){}
  }
  function renderList(id){
    const listEl=document.getElementById(id+'-comment-list');
    const arr=model.stories[id]||[];
    if(!arr.length){
      listEl.innerHTML='<li class="empty-comments">No comments yet.</li>';
    }else{
      listEl.innerHTML=arr.map((c,i)=>`
        <li class="comment-item" data-idx="${i}">
          <div>${escapeHTML(c.text)}</div>
          <time datetime="${c.ts}" aria-label="Added ${new Date(c.ts).toLocaleString()}">${new Date(c.ts).toLocaleString()}</time>
          <button data-del="${i}" aria-label="Delete comment ${i+1} for ${id}">×</button>
        </li>`).join('');
    }
    const count=document.querySelector('[data-count="'+id+'"]');
    if(count) count.textContent=arr.length;
  }

  document.addEventListener('submit',e=>{
    const form=e.target.closest('.comment-form');
    if(!form) return;
    e.preventDefault();
    const story=form.getAttribute('data-story');
    const ta=form.querySelector('textarea');
    const text=ta.value.trim();
    if(!text) return;
    model.stories[story].push({text,ts:new Date().toISOString()});
    ta.value='';
    persist();
    renderList(story);
    announce('Comment added to '+story);
  });

  document.addEventListener('click',e=>{
    const del=e.target.closest('button[data-del]');
    if(!del) return;
    const idx=+del.getAttribute('data-del');
    const story=del.closest('.story').getAttribute('data-story-id');
    if(!confirm('Delete this comment?')) return;
    model.stories[story].splice(idx,1);
    persist();
    renderList(story);
    announce('Comment deleted from '+story);
  });

  const exportBtn=document.getElementById('export-comments');
  const importInput=document.getElementById('import-comments');
  const statusEl=document.getElementById('comments-status');

  exportBtn?.addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify(model,null,2)],{type:'application/json'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download=EXPORT_FILE;
    a.click();
    URL.revokeObjectURL(a.href);
    setStatus('Exported '+EXPORT_FILE);
  });

  importInput?.addEventListener('change',e=>{
    const file=e.target.files[0];
    if(!file) return;
    const reader=new FileReader();
    reader.onload=()=>{
      try{
        const parsed=JSON.parse(reader.result);
        if(!parsed.stories) throw new Error('Missing stories key');
        model=parsed;
        persist();
        Object.keys(model.stories).forEach(renderList);
        setStatus('Imported '+file.name);
        announce('Comments imported');
      }catch(err){
        setStatus('Import failed: '+err.message);
      }
    };
    reader.readAsText(file);
    importInput.value='';
  });

  function setStatus(msg){
    statusEl.textContent=msg;
    setTimeout(()=>{if(statusEl.textContent===msg) statusEl.textContent='';},4500);
  }
  function announce(msg){
    const live=document.getElementById('comments-live');
    live.textContent='';
    setTimeout(()=>{live.textContent=msg;},20);
  }
})();
</script>
</body>
</html>
```