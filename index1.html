<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Service Based Launchpad Status</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="color-scheme" content="light dark">
<meta name="description" content="Service Based Launchpad status and service list">
<style>
/* Accessible, higher-contrast design tokens */
:root{
  --bg:#F3F6F9;
  --panel:#FFFFFF;
  --panel-alt:#F0F4F7;
  --panel-hover:#E6EDF3;
  --border:#C0CCD6;
  --border-soft:#D4DEE6;
  --text:#17212B;
  --text-soft:#31404C;
  --muted:#536372;
  --accent:#005EB8;
  --accent-hover:#004B90;
  --success:#156D37;
  --danger:#B42022;
  --warn:#8F5A02;
  --inactive:#5B6672;
  --info:#0F4D78;
  --tint-accent:#E0EFFA;
  --tint-success:#D9F2E3;
  --tint-danger:#F9DFDE;
  --tint-inactive:#E0E5EA;
  --tint-warn:#F5E8CE;
  --focus:0 0 0 3px rgba(0,94,184,.55);
  --radius:18px;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  font-size:15px;
  color-scheme: light dark;
}

/* High contrast user preference */
@media (prefers-contrast: more){
  :root{
    --panel-alt:#E2E8EE;
    --panel-hover:#D6E0E8;
    --border:#7A8894;
    --border-soft:#9AA6B1;
    --accent:#00427F;
    --accent-hover:#00345F;
    --focus:0 0 0 3px rgba(0,66,127,.7);
  }
  .status-label,
  .pill,
  .deploy-badge,
  .level-badge,
  .count-chip,
  .inline-pill{box-shadow:0 0 0 2px rgba(255,255,255,.85),0 0 0 4px var(--accent);}
}

/* Dark theme tuned for WCAG contrast */
@media (prefers-color-scheme:dark){
  :root{
    --bg:#1C242C;
    --panel:#242F37;
    --panel-alt:#2B3741;
    --panel-hover:#32414C;
    --border:#41505B;
    --border-soft:#4E5F6C;
    --text:#F2F5F7;
    --text-soft:#C3CDD4;
    --muted:#9AADB8;
    --accent:#4C93F0;
    --accent-hover:#327DDC;
    --success:#41B46B;
    --danger:#E0524F;
    --warn:#D79A34;
    --inactive:#8A97A3;
    --info:#63B4EA;
    --tint-accent:#153452;
    --tint-success:#123D23;
    --tint-danger:#4A1C1B;
    --tint-inactive:#354047;
    --tint-warn:#4A3817;
    --focus:0 0 0 3px rgba(76,147,240,.55);
  }
  .item{background:var(--panel-alt);}
  .highlight{background:#705A1E;color:#fff;}
  .count-chip,.inline-pill{background:#173A55;border-color:#2A5E82;color:#93D0FF;}
  .filter-chip{background:var(--accent);}
  .clear-btn{background:#33404A;}
  .clear-btn:not(:disabled):hover{background:#3D4C57;}
  .pill{background:#3A4854;color:#fff;}
  .deploy-badge.empty{background:#43525E;color:#AEBBC6;}
  .rules-table th{background:#2F3A44;}
  .rules-table td[data-no="true"]{background:#36424B;color:#8EA1AF;}
  .rules-table td[data-yes="true"]{background:#153823;color:#52C477;}
  .tag-badge{background:#394A56;color:#D1DBE2;}
  body{background:linear-gradient(180deg,#1A2229 0%,var(--bg) 140px);}
  .search-box input,.role-select,.tenant-select,.filter-select,.sort-select{
    background:#213038;
    color:var(--text);
    -webkit-text-fill-color:var(--text);
    border-color:var(--border-soft);
  }
  .search-box input::placeholder{color:#93A5B2;}
  .submit-btn:disabled{background:#3B5F84;border-color:#3B5F84;}
  .status-label.enabled{background:#156D37;color:#ffffff;}
  .status-label.disabled{background:#6E1D1C;color:#FFDAD8;}
  .status-label{background:#0F3A5B;color:#A7D7F5;}
  .mini-switch span{background:#596978;}
  .mini-switch input:checked+span{background:var(--success);}
  .summary-bar strong{color:#fff;}
  .clear-btn,.reset-btn{
    background:#2C3A45;
    color:var(--text);
    -webkit-text-fill-color:var(--text);
    border-color:var(--border-soft);
  }
  .clear-btn:not(:disabled):hover,.reset-btn:not(:disabled):hover{background:#354550;}
}

/* Utility contrast helpers */
.high-contrast-outline:focus-visible{outline:none;box-shadow:var(--focus);}

*{box-sizing:border-box;}
body{margin:0;background:linear-gradient(180deg,#F9FBFD 0%,var(--bg) 140px);color:var(--text);-webkit-font-smoothing:antialiased;line-height:1.45;}
h1,h2{margin:0;font-weight:600;line-height:1.2;}
button{font-family:inherit;}
a{color:var(--accent);text-decoration:none;}a:hover{text-decoration:underline;}

.layout{max-width:1300px;margin:0 auto;padding:1rem 1.1rem 2rem;display:grid;gap:1rem;grid-template-columns:224px 1fr;}
@media (max-width:880px){.layout{grid-template-columns:1fr;}}

.left-column{display:flex;flex-direction:column;gap:.55rem;position:sticky;top:1rem;align-self:start;height:fit-content;}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:.9rem 1.05rem 1.1rem;display:flex;flex-direction:column;gap:.65rem;box-shadow:0 2px 6px -2px rgba(0,0,0,.08);}
aside.panel{position:static;}

.menu-title{font-size:.95rem;margin:0 0 .35rem;}
.inline-note{font-size:.58rem;color:var(--muted);line-height:1.3;margin:0 0 .4rem;}

.nav-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.5rem;}
.nav-btn{all:unset;cursor:not-allowed;border:1px solid var(--border-soft);background:var(--panel-alt);padding:.65rem .75rem;border-radius:14px;font-size:.65rem;font-weight:600;letter-spacing:.05em;color:var(--text-soft);}
.nav-btn[aria-current="true"]{cursor:default;background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 2px 8px -3px rgba(0,94,184,.45);}

.header-bar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.8rem;}
.header-bar h1{display:flex;align-items:center;gap:.55rem;font-size:1.32rem;}

.status-label{font-weight:700;letter-spacing:.05em;display:inline-flex;align-items:center;gap:.35rem;font-size:.68rem;padding:.4rem .75rem;border-radius:999px;line-height:1;box-shadow:0 0 0 1px rgba(0,0,0,.05);}
.status-label.enabled{background:var(--success);color:#fff;}
.status-label.disabled{background:var(--danger);color:#fff;}
.status-label .icon{font-size:.85em;}

.toggle-bar{display:flex;align-items:center;gap:1.1rem;flex-wrap:wrap;}
.cluster{display:inline-flex;align-items:center;gap:.55rem;font-size:.58rem;font-weight:700;letter-spacing:.07em;color:var(--muted);}

.status-switch{position:relative;display:inline-block;width:56px;height:30px;}
.status-switch input{opacity:0;width:0;height:0;}
.status-switch span{position:absolute;inset:0;background:#99A6B2;border-radius:30px;cursor:pointer;transition:.28s;box-shadow:inset 0 0 0 1px rgba(0,0,0,.08);}
.status-switch span:before{content:"";position:absolute;height:24px;width:24px;left:3px;top:3px;background:#fff;border-radius:50%;transition:.28s;box-shadow:0 2px 4px rgba(0,0,0,.25);}
.status-switch input:checked+span{background:var(--success);}
.status-switch input:checked+span:before{transform:translateX(26px);}

.role-select,.tenant-select,.filter-select,.sort-select{
  padding:.55rem .7rem;
  font-size:.62rem;
  border:1px solid var(--border);
  border-radius:10px;
  background:#fff;
  min-width:150px;
  color:var(--text);
  font-weight:600;
  letter-spacing:.05em;
  text-transform:uppercase;
  appearance:none;
  background-image:linear-gradient(to bottom,rgba(255,255,255,0),rgba(255,255,255,0));
  -webkit-text-fill-color:var(--text);
}

/* Explicit text & background */
.role-select,
.tenant-select,
.filter-select,
.sort-select {
  background-color:var(--panel-alt);
  color:var(--text);
  -webkit-text-fill-color:var(--text);
  line-height:1.2;
}

.sort-select{text-transform:none;min-width:170px;}
.role-select:focus,.tenant-select:focus,.filter-select:focus,.sort-select:focus{
  outline:none;
  box-shadow:var(--focus);
  border-color:var(--accent);
  background:var(--panel);
  -webkit-text-fill-color:var(--text);
}

.role-select option,
.tenant-select option,
.filter-select option,
.sort-select option {
  background:var(--panel);
  color:var(--text);
}

/* Dark mode explicit overrides handled above */

/* High contrast user pref */
@media (prefers-contrast:more){
  .role-select,
  .tenant-select,
  .filter-select,
  .sort-select{
    background:var(--panel-hover);
    color:var(--text);
    -webkit-text-fill-color:var(--text);
  }
  .role-select option,
  .tenant-select option,
  .filter-select option,
  .sort-select option{
    background:var(--panel);
    color:var(--text);
  }
}

.desc-block{margin:0;font-size:.6rem;color:var(--text-soft);line-height:1.4;max-width:70ch;}
.status-hint{font-size:.55rem;color:var(--muted);margin:0;}

.tools-bar{display:flex;flex-wrap:wrap;align-items:center;gap:.55rem;}

/* SEARCH / CLEAR / RESET IMPROVEMENTS */
.search-box{position:relative;display:flex;}
.search-box svg{position:absolute;left:.55rem;top:50%;transform:translateY(-50%);width:15px;height:15px;stroke:#546575;stroke-width:2;fill:none;}
.search-box input{
  padding:.55rem .7rem .55rem 2.05rem;
  font-size:.66rem;
  border:1px solid var(--border);
  border-radius:10px;
  min-width:230px;
  background:var(--panel);
  color:var(--text);
  -webkit-text-fill-color:var(--text);
  font-weight:600;
  line-height:1.2;
}
.search-box input::placeholder{
  color:var(--muted);
  opacity:.95;
  font-weight:500;
}
.search-box input:focus{
  outline:none;
  box-shadow:var(--focus);
  border-color:var(--accent);
  background:var(--panel-alt);
}

.clear-btn,.reset-btn{
  background:var(--panel-alt);
  border:1px solid var(--border);
  padding:.55rem .8rem;
  font-size:.58rem;
  font-weight:700;
  letter-spacing:.05em;
  border-radius:9px;
  cursor:pointer;
  color:var(--text);
  -webkit-text-fill-color:var(--text);
  display:inline-flex;
  align-items:center;
  gap:.35rem;
  line-height:1.1;
  min-height:33px;
  transition:.18s;
  text-transform:uppercase;
}
.clear-btn:disabled,.reset-btn:disabled{
  opacity:.55;
  cursor:not-allowed;
}
.clear-btn:not(:disabled):hover,.reset-btn:not(:disabled):hover{
  background:var(--panel-hover);
}
.clear-btn:focus-visible,.reset-btn:focus-visible{
  outline:none;
  box-shadow:var(--focus);
}

.inline-stat{margin-left:auto;display:flex;flex-wrap:wrap;gap:.45rem;font-size:.5rem;color:var(--muted);}
.count-chip,.inline-pill{
  background:var(--tint-accent);
  border:1px solid #B3D4EC;
  padding:2px 8px;
  border-radius:999px;
  font-size:.5rem;
  font-weight:700;
  letter-spacing:.05em;
  color:var(--accent);
  line-height:1.1;
}

.active-filters{display:flex;align-items:center;flex-wrap:wrap;gap:.4rem;font-size:.5rem;margin-top:.1rem;}
.filter-chip{
  background:var(--accent);
  color:#fff;
  padding:4px 10px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  gap:.4rem;
  font-weight:600;
  letter-spacing:.05em;
}
.filter-chip button{all:unset;cursor:pointer;font-size:.8em;line-height:1;padding:0 .3em;}
.filter-chip button:focus-visible{outline:2px solid #fff;border-radius:4px;}

.quick-hints{display:flex;gap:.4rem;flex-wrap:wrap;font-size:.47rem;color:var(--muted);margin:0;}
.quick-hints span{
  background:var(--panel-alt);
  border:1px solid var(--border-soft);
  padding:4px 7px;
  border-radius:6px;
  letter-spacing:.05em;
}

.list-panel{gap:.55rem;position:relative;}
.list-header h2{font-size:.9rem;margin:0;}

.list-col-head{
  display:grid;
  grid-template-columns:minmax(190px,260px) 110px 150px 110px 74px;
  gap:.55rem;
  align-items:center;
  padding:0 .75rem .45rem;
  font-size:.5rem;
  letter-spacing:.06em;
  text-transform:uppercase;
  font-weight:700;
  color:var(--muted);
  border-bottom:1px solid var(--border-soft);
}
@media (max-width:820px){.list-col-head{display:none;}}

.item-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.55rem;}
.item{
  background:var(--panel-alt);
  border:1px solid var(--border-soft);
  border-radius:14px;
  padding:.8rem .95rem .82rem;
  display:grid;
  grid-template-columns:minmax(190px,260px) 110px 150px 110px 74px;
  gap:.55rem;
  align-items:start;
  transition:.18s;
  background-clip:padding-box;
}
.item:hover{background:var(--panel-hover);}
@media (max-width:820px){.item{grid-template-columns:1fr;}}

.item-title{font-size:.72rem;font-weight:600;margin:0 0 .28rem;line-height:1.22;color:var(--text);}
.item-desc{font-size:.56rem;color:var(--text-soft);margin:0 0 .4rem;line-height:1.35;}
.item-meta{font-size:.47rem;color:var(--muted);display:flex;gap:.55rem;flex-wrap:wrap;margin:0;}
.inline-updated{font-variant-numeric:tabular-nums;}

.highlight{background:#FFD966;color:#3A2A00;padding:0 3px;border-radius:4px;}

.pill{
  display:inline-flex;
  align-items:center;
  gap:.45rem;
  font-size:.56rem;
  font-weight:600;
  letter-spacing:.05em;
  padding:6px 11px;
  border-radius:999px;
  line-height:1;
  text-transform:uppercase;
  white-space:nowrap;
  background:#D7E2EA;
  color:#0F2736;
  box-shadow:0 0 0 1px rgba(0,0,0,.04),0 1px 2px rgba(0,0,0,.06);
}

.status-pill.active{background:var(--success);color:#fff;box-shadow:0 0 0 1px rgba(0,0,0,.15);}
.status-pill.inactive{background:var(--inactive);color:#fff;box-shadow:0 0 0 1px rgba(0,0,0,.12);}
.deploy-badge.success{background:var(--success);color:#fff;}
.deploy-badge.fail{background:var(--danger);color:#fff;}
.deploy-badge.empty{background:#C1CBD3;color:#24323E;}
.level-badge.tenant{background:var(--accent);color:#fff;}
.level-badge.account{background:var(--inactive);color:#fff;}
.level-badge svg,.deploy-badge svg,.status-pill svg{width:.85em;height:.85em;display:block;}

.enable-cell{display:flex;align-items:center;justify-content:flex-start;}

.mini-switch{position:relative;display:inline-block;width:42px;height:22px;}
.mini-switch input{opacity:0;width:0;height:0;}
.mini-switch span{
  position:absolute;inset:0;
  background:#9AA6B1;
  border-radius:22px;
  cursor:pointer;
  transition:.22s;
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.08);
}
.mini-switch span:before{
  content:"";
  position:absolute;
  height:16px;width:16px;
  left:3px;top:3px;
  background:#fff;
  border-radius:50%;
  transition:.22s;
  box-shadow:0 1px 3px rgba(0,0,0,.35);
}
.mini-switch input:checked+span{background:var(--success);}
.mini-switch input:checked+span:before{transform:translateX(20px);}
.mini-switch input:focus-visible+span{outline:none;box-shadow:var(--focus);}

body.launchpad-disabled .mini-switch span{background:var(--inactive);cursor:not-allowed;opacity:.65;}
body.launchpad-disabled .mini-switch input:checked+span{background:var(--inactive);}
body.launchpad-disabled .item{opacity:.55;filter:grayscale(.1);}

.deploy-cell{display:flex;flex-direction:column;align-items:flex-start;gap:4px;}
.deploy-last-run{font-size:.46rem;letter-spacing:.05em;color:var(--muted);text-transform:uppercase;}

.empty-hint{
  font-size:.6rem;
  color:var(--muted);
  padding:.5rem .4rem;
  margin:.3rem 0 0;
  background:var(--panel-alt);
  border:1px dashed var(--border-soft);
  border-radius:10px;
  text-align:center;
}

.fade-in{animation:fade .18s ease;}
@keyframes fade{from{opacity:0;transform:translateY(4px);}to{opacity:1;transform:translateY(0);}}

.tag-badge{
  background:#D6E2EB;
  color:#24323E;
  padding:3px 6px;
  border-radius:6px;
  font-size:.44rem;
  font-weight:700;
  letter-spacing:.05em;
  text-transform:uppercase;
}

.summary-bar{
  font-size:.55rem;
  color:var(--muted);
  display:flex;
  flex-wrap:wrap;
  gap:.65rem;
  align-items:center;
  margin-top:.3rem;
}
.summary-bar strong{color:var(--text);font-weight:700;}

footer{max-width:1300px;margin:1.4rem auto .8rem;padding:0 1.1rem;font-size:.5rem;color:var(--muted);text-align:center;}

:focus-visible{outline:none;box-shadow:var(--focus);}

.visually-hidden{
  position:absolute!important;
  width:1px;height:1px;
  padding:0;margin:0;
  clip:rect(1px,1px,1px,1px);
  clip-path:inset(50%);
  overflow:hidden;
  white-space:nowrap;
  border:0;
}

@media (prefers-reduced-motion:reduce){
  *{animation:none!important;transition:none!important;}
}

body:not(.show-enable-column) .list-col-head span:last-child{display:none;}
body:not(.show-enable-column) .item{grid-template-columns:minmax(190px,260px) 110px 150px 110px;}
body:not(.show-enable-column) .item .enable-cell{display:none;}

.context-panel{gap:.75rem;}
.context-panel h2{font-size:.8rem;letter-spacing:.06em;text-transform:uppercase;color:var(--muted);margin:0;}
.context-fields{display:flex;flex-direction:column;gap:.65rem;}
.context-fields .field{display:flex;flex-direction:column;gap:.25rem;}
.context-fields label{font-size:.55rem;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:var(--muted);}

@media (max-width:880px){
  .left-column{position:static;}
  .context-fields{flex-direction:row;flex-wrap:wrap;}
  .context-fields .field{min-width:140px;}
}

.changes-bar{display:flex;justify-content:flex-end;margin-top:.65rem;}

.submit-btn{
  background:var(--accent);
  color:#fff;
  border:1px solid var(--accent);
  font-size:.58rem;
  letter-spacing:.06em;
  font-weight:700;
  text-transform:uppercase;
  padding:.6rem 1rem;
  border-radius:10px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:.5rem;
  transition:.18s;
}
.submit-btn:hover:not(:disabled){background:var(--accent-hover);border-color:var(--accent-hover);}
.submit-btn:disabled{opacity:.48;cursor:not-allowed;background:#7BAED8;border-color:#7BAED8;}
.submit-btn:focus-visible{outline:none;box-shadow:var(--focus);}

.key-hint{
  background:#D4E5F2;
  color:#0A4D80;
  padding:2px 6px;
  border-radius:6px;
  font-size:.48rem;
  font-weight:600;
  letter-spacing:.05em;
}
@media (prefers-color-scheme:dark){
  .key-hint{background:#173A54;color:#8BC9F2;}
}

.guide-panel{margin:0;padding:.9rem 1.05rem 1.1rem;}
.guide-panel h2{font-size:.9rem;margin:0 0 .55rem;}
.guide-list{margin:.1rem 0 .9rem;padding-left:1.15rem;font-size:.63rem;line-height:1.34;}
.guide-list li{margin:.35rem 0;}
.guide-panel strong{color:var(--text);}
.guide-panel p{margin:.25rem 0;font-size:.58rem;line-height:1.32;}
@media (max-width:880px){.guide-list{font-size:.66rem;}}

/* Rules table */
.rules-panel h2{font-size:.9rem;margin:0 0 .55rem;}
.rules-table{width:100%;border-collapse:collapse;font-size:.58rem;letter-spacing:.04em;}
.rules-table th,.rules-table td{border:1px solid var(--border-soft);padding:.5rem .6rem;text-align:left;vertical-align:top;}
.rules-table th{background:var(--panel-alt);text-transform:uppercase;font-size:.52rem;font-weight:700;}
.rules-table td[data-yes="true"]{background:var(--success);color:#fff;font-weight:600;}
.rules-table td[data-no="true"]{background:var(--inactive);color:#fff;font-weight:600;}
.rules-table code{background:#E3EBF1;padding:2px 4px;border-radius:4px;font-size:.55rem;}
@media (max-width:760px){
  .rules-table{font-size:.62rem;}
  .rules-table th{font-size:.56rem;}
}

/* Skeleton loading */
.skeleton{
  position:relative;
  overflow:hidden;
  background:var(--panel-alt);
  border:1px solid var(--border-soft);
  border-radius:14px;
  padding:.9rem .95rem;
}
.skel-bar{height:10px;border-radius:6px;background:var(--tint-inactive);margin:4px 0 9px;width:60%;}
.skel-row{display:grid;grid-template-columns:1fr 120px 140px 100px 60px;gap:.65rem;align-items:center;}
.skel-pill{height:20px;border-radius:999px;background:var(--tint-inactive);}
@media (prefers-color-scheme:dark){
  .skel-bar,.skel-pill{background:#3A4650;}
}
.skeleton:before{
  content:"";position:absolute;inset:0;
  background:linear-gradient(110deg,transparent 0%,rgba(255,255,255,.4) 45%,transparent 90%);
  animation:shimmer 1.4s linear infinite;
  mix-blend-mode:overlay;
  opacity:.7;
}
@keyframes shimmer{from{transform:translateX(-100%);}to{transform:translateX(100%);}}

/* Responsive tweaks */
@media (max-width:620px){
  .tools-bar{flex-direction:column;align-items:stretch;}
  .inline-stat{margin-left:0;}
  .summary-bar{flex-direction:column;align-items:flex-start;}
}
</style>
</head>
<body>
<a href="#main" class="visually-hidden">Skip to content</a>
<div class="layout">
  <div class="left-column">
    <aside class="panel" aria-label="Primary navigation">
      <h2 class="menu-title">Menu</h2>
      <p class="inline-note" id="nav-note">Navigation locked to Service Based Launchpad.</p>
      <ul class="nav-list" aria-describedby="nav-note">
        <li><button class="nav-btn" disabled aria-disabled="true">Tenant Details</button></li>
        <li><button class="nav-btn" disabled aria-disabled="true">Attestation Details</button></li>
        <li><button class="nav-btn" disabled aria-disabled="true">Prisma Details</button></li>
        <li><button class="nav-btn" aria-current="true" aria-label="Service Based Launchpad (active)">Service Based Launchpad</button></li>
        <li><button class="nav-btn" disabled aria-disabled="true">Attestion Log</button></li>
      </ul>
    </aside>

    <section class="panel context-panel" aria-labelledby="context-heading">
      <h2 id="context-heading">Context</h2>
      <div class="context-fields" role="group" aria-label="Tenant and Role selectors">
        <div class="field">
          <label for="tenant-type">Tenant Type</label>
          <select id="tenant-type" class="tenant-select" aria-label="Select tenant type">
            <option value="Managed">Managed</option>
            <option value="Restricted">Restricted</option>
            <option value="Partially Managed">Partially Managed</option>
            <option value="Unmanaged">Unmanaged</option>
          </select>
        </div>
        <div class="field">
          <label for="role-select">Role</label>
          <select id="role-select" class="role-select" aria-label="Select role (Admin or Read Only)">
            <option value="Admin">Admin</option>
            <option value="Read Only">Read Only</option>
          </select>
        </div>
      </div>
      <p class="quick-hints" aria-hidden="true">
        <span>/ focus search</span><span>Cmd/Ctrl+Enter submit</span><span>Esc clear query</span>
      </p>
    </section>
  </div>

  <main id="main" style="display:flex;flex-direction:column;gap:1rem;min-width:0;">
    <section class="panel header-panel" aria-labelledby="header-title">
      <div class="header-bar">
        <h1 id="header-title">
          Service Based Launchpad
          <span id="lp-status-label" class="status-label enabled" aria-live="polite">
            <span class="icon" aria-hidden="true">✓</span>Enabled
          </span>
        </h1>
        <div class="toggle-bar">
          <div class="cluster" role="group" aria-label="Launchpad availability">
            <span>Enable Layout</span>
            <label class="status-switch">
              <input id="lp-status-toggle" type="checkbox" aria-label="Toggle Launchpad editing" checked>
              <span></span>
            </label>
          </div>
        </div>
      </div>
      <p class="desc-block">
        Enable column shown only for Admin + (Partially Managed | Unmanaged). Layout off = toggles disabled (values retained). Sorting & filters persist.
      </p>
      <p class="status-hint" id="status-hint" aria-live="polite"></p>
      <div class="summary-bar" id="summary-bar" aria-live="polite"></div>
    </section>

    <section class="panel list-panel" aria-labelledby="list-heading">
      <div class="list-header" style="display:flex;flex-direction:column;gap:.55rem;">
        <div style="display:flex;align-items:center;gap:.7rem;flex-wrap:wrap;">
          <h2 id="list-heading" style="margin-right:.25rem;">Services</h2>
          <div class="tools-bar" role="group" aria-label="Filters and sorting">
            <div class="search-box">
              <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="7"/><line x1="16.6" y1="16.6" x2="21" y2="21"/></svg>
              <input id="search-box" type="search" placeholder="Search..." aria-label="Search services (name & description)">
            </div>
            <select id="status-filter" class="filter-select" aria-label="Filter by status">
              <option value="all">All Statuses</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
            <select id="sort-select" class="sort-select" aria-label="Sort services">
              <option value="name-asc">Name A→Z</option>
              <option value="name-desc">Name Z→A</option>
              <option value="status-active-first">Status (Active first)</option>
              <option value="updated-desc">Recently Updated</option>
              <option value="updated-asc">Least Recently Updated</option>
            </select>
            <button id="clear-filters" class="clear-btn" type="button" aria-label="Clear active filters" disabled>Clear</button>
            <button id="reset-all" class="reset-btn" type="button" aria-label="Reset filters and sorting" disabled>Reset</button>
            <div class="inline-stat" role="group" aria-label="Counts">
              <span id="count-total" class="count-chip" aria-live="polite" aria-label="Visible services out of total services">0/0</span>
              <span id="count-active" class="inline-pill" aria-label="Active services">Active:0</span>
              <span id="count-inactive" class="inline-pill" aria-label="Inactive services">Inactive:0</span>
            </div>
          </div>
        </div>
        <div id="active-filters" class="active-filters" aria-live="polite"></div>
      </div>
      <div class="list-col-head" aria-hidden="true">
        <span>Service</span><span>Status</span><span>Deployment</span><span>Level</span><span>Enable</span>
      </div>
      <ul class="item-list" id="item-list" aria-label="Service list" aria-live="polite"></ul>
      <p id="empty-hint" class="empty-hint" hidden>No matching services.</p>
      <div id="changes-bar" class="changes-bar" hidden>
        <button id="submit-changes" class="submit-btn" type="button" aria-disabled="true" disabled>
          Submit Changes <span class="key-hint">Cmd/Ctrl+Enter</span>
        </button>
      </div>
    </section>

    <section class="panel guide-panel" aria-labelledby="usage-heading">
      <h2 id="usage-heading">Usage</h2>
      <ol class="guide-list">
        <li><strong>Context:</strong> Tenant & Role persist (local).</li>
        <li><strong>Enable Column:</strong> Admin + (Partially Managed | Unmanaged).</li>
        <li><strong>Layout Toggle:</strong> Disables enable switches without clearing edits.</li>
        <li><strong>Sorting:</strong> Use sort menu; persists across reload.</li>
        <li><strong>Search:</strong> Matches name & description; highlight shown.</li>
        <li><strong>Filters Chips:</strong> Remove with × or Clear / Reset buttons.</li>
        <li><strong>Staging:</strong> Unsaved enable-state changes activate Submit.</li>
        <li><strong>Keyboard:</strong> / or f = search focus, Esc clears search, Space/Enter toggle, Cmd/Ctrl+Enter submit.</li>
        <li><strong>Accessibility:</strong> Live regions announce role, tenant, toggle, submit actions.</li>
      </ol>
      <p>Color legend: Green=Active, Gray=Inactive, Red=Failed deployment, Blue=Tenant level.</p>
    </section>

    <section class="panel rules-panel" aria-labelledby="rules-heading">
      <h2 id="rules-heading">Role / Tenant Effects</h2>
      <table class="rules-table" aria-describedby="rules-note">
        <thead>
        <tr>
          <th>Tenant Type</th><th>Role</th><th>Enable Column Visible</th><th>Toggles Interactive (Layout ON)</th><th>Submit Changes Bar</th><th>Notes</th>
        </tr>
        </thead>
        <tbody>
        <tr><td rowspan="2">Managed</td><td>Admin</td><td data-no="true">—</td><td data-no="true">—</td><td data-yes="true">✓</td><td>No enable column.</td></tr>
        <tr><td>Read Only</td><td data-no="true">—</td><td data-no="true">—</td><td data-no="true">—</td><td>Read only view.</td></tr>
        <tr><td rowspan="2">Restricted</td><td>Admin</td><td data-no="true">—</td><td data-no="true">—</td><td data-yes="true">✓</td><td>Same as Managed.</td></tr>
        <tr><td>Read Only</td><td data-no="true">—</td><td data-no="true">—</td><td data-no="true">—</td><td>All toggles suppressed.</td></tr>
        <tr><td rowspan="2">Partially Managed</td><td>Admin</td><td data-yes="true">✓</td><td data-yes="true">✓</td><td data-yes="true">✓</td><td>Requires layout ON.</td></tr>
        <tr><td>Read Only</td><td data-no="true">—</td><td data-no="true">—</td><td data-no="true">—</td><td>Enable hidden.</td></tr>
        <tr><td rowspan="2">Unmanaged</td><td>Admin</td><td data-yes="true">✓</td><td data-yes="true">✓</td><td data-yes="true">✓</td><td>Same as Partial.</td></tr>
        <tr><td>Read Only</td><td data-no="true">—</td><td data-no="true">—</td><td data-no="true">—</td><td>Read only.</td></tr>
        </tbody>
      </table>
      <p id="rules-note" style="margin:.55rem 0 0;font-size:.55rem;color:var(--muted);">
        Enable column appears only for Admin + (Partially Managed | Unmanaged). Layout OFF disables switches but keeps values. Submit button shown only for Admin; enabled if staged changes exist.
      </p>
    </section>
  </main>
</div>

<footer>
  Shortcuts: / focus search • Esc clear search • Space/Enter toggle • Cmd/Ctrl+Enter submit
</footer>

<div id="live-region" class="visually-hidden" aria-live="polite"></div>
<div id="live-assertive" class="visually-hidden" aria-live="assertive"></div>

<script>
(()=>{
  // ...existing code...
  let seq=0;
  const now=()=>Date.now();
  const minutesAgo=m=>now()-m*60000;
  const svc=(name,active,deployment,level,updatedM,lastRunM,desc)=>
    ({id:++seq,name,active,deployment,level,updated:minutesAgo(updatedM),lastRun:lastRunM!=null?minutesAgo(lastRunM):minutesAgo(updatedM+8),desc});

  const DATASETS = {
    'Managed': [
      svc('Identity Core', true,'Successful','tenant',8,16,'Central authentication & SSO integration.'),
      svc('Policy Engine', true,'Successful','tenant',21,34,'Organizational policy evaluation & enforcement.'),
      svc('Billing Reconciliation', true,'','account',55,70,'Maps usage metrics to invoice line items.'),
      svc('Secrets Vault', true,'Successful','tenant',13,26,'Managed secret storage & key rotations.'),
      svc('Compliance Scanner', true,'Failed','tenant',41,58,'Baseline compliance and drift detection.'),
      svc('Geo Replicator', false,'','account',95,120,'Cross-region replication for critical datasets.')
    ],
    'Restricted': [
      svc('Access Registry', true,'Successful','tenant',6,14,'Registry of tenant & account access grants.'),
      svc('Audit Log Stream', true,'Successful','tenant',32,60,'Immutable audit trail export & retention.'),
      svc('Tag Normalizer', false,'Failed','tenant',18,36,'Enforces unified tagging conventions.'),
      svc('Sensitive Data Gateway', true,'','account',75,140,'Broker for sensitive data egress.'),
      svc('Change Guard', false,'','tenant',52,90,'Restricts high-risk mutation operations.')
    ],
    'Partially Managed': [
      svc('Notification Service', true,'Failed','tenant',9,18,'Email / SMS dispatch pipeline.'),
      svc('Report Generator', true,'Successful','tenant',25,36,'Automated scheduled report production.'),
      svc('Cache Layer', false,'Successful','account',180,210,'Low-latency distributed in-memory cache.'),
      svc('Webhook Relay', false,'Failed','account',6,14,'Third-party webhook ingestion & relay.'),
      svc('Tag Normalizer', true,'Successful','tenant',11,24,'Tag enforcement across asset inventory.'),
      svc('Image Optimizer', false,'','account',95,140,'On-demand media optimization & resizing.')
    ],
    'Unmanaged': [
      svc('Prototype ML', true,'Successful','account',58,70,'Experimental model training environment.'),
      svc('Custom Analytics', true,'','tenant',33,46,'Ad-hoc analytics & exploration stack.'),
      svc('Data Sandbox', false,'Failed','account',14,29,'Isolated data experimentation workspace.'),
      svc('Internal Dashboard', true,'Successful','tenant',7,15,'Legacy dashboard for internal ops.'),
      svc('Webhook Relay', true,'Successful','account',4,12,'Inbound webhook transformation & routing.'),
      svc('Image Optimizer', false,'Failed','account',121,180,'Media optimization & CDN preprocessing.')
    ]
  };

  let services = [];
  let baseline = [];
  let loading = false;

  // State / elements
  const listEl = document.getElementById('item-list');
  const emptyHint = document.getElementById('empty-hint');
  const statusToggle = document.getElementById('lp-status-toggle');
  const statusLabel = document.getElementById('lp-status-label');
  const roleSelect = document.getElementById('role-select');
  const tenantTypeSelect = document.getElementById('tenant-type');
  const searchBox = document.getElementById('search-box');
  const statusFilter = document.getElementById('status-filter');
  const sortSelect = document.getElementById('sort-select');
  const clearBtn = document.getElementById('clear-filters');
  const resetBtn = document.getElementById('reset-all');
  const statusHint = document.getElementById('status-hint');
  const activeFiltersEl = document.getElementById('active-filters');
  const submitBtn = document.getElementById('submit-changes');
  const changesBar = document.getElementById('changes-bar');
  const live = document.getElementById('live-region');
  const liveAssert = document.getElementById('live-assertive');
  const countTotal = document.getElementById('count-total');
  const countActive = document.getElementById('count-active');
  const countInactive = document.getElementById('count-inactive');
  const summaryBar = document.getElementById('summary-bar');

  // Persistent keys
  const LS_KEYS = {
    role:'lp_role',
    tenant:'lp_tenant',
    layout:'lp_layout_enabled',
    query:'lp_query',
    status:'lp_status_filter',
    sort:'lp_sort'
  };

  let launchpadActive = true;
  let role = 'Admin';
  let tenantType = 'Managed';
  let query = '';
  let statusSel = 'all';
  let sortMode = 'name-asc';
  let renderQueued=false;

  const ENABLE_OK_TYPES = new Set(['Partially Managed','Unmanaged']);

  const saveLS=(k,v)=>{try{localStorage.setItem(k,v);}catch{}};
  const loadLS=k=>{try{return localStorage.getItem(k);}catch{return null;}};

  (()=>{
    const r=loadLS(LS_KEYS.role); if(r) role=r;
    const t=loadLS(LS_KEYS.tenant); if(t) tenantType=t;
    const l=loadLS(LS_KEYS.layout); if(l==='false') launchpadActive=false;
    const q=loadLS(LS_KEYS.query); if(q) query=q;
    const sf=loadLS(LS_KEYS.status); if(sf) statusSel=sf;
    const sm=loadLS(LS_KEYS.sort); if(sm) sortMode=sm;
    roleSelect.value=role;
    tenantTypeSelect.value=tenantType;
    statusToggle.checked=launchpadActive;
    if(query){ searchBox.value=query; }
    statusFilter.value=statusSel;
    sortSelect.value=sortMode;
  })();

  const rel = ts => {
    const diff = Date.now()-ts;
    const m = (diff/60000)|0;
    if(m<60) return m+'m ago';
    const h=(m/60)|0;
    if(h<24) return h+'h ago';
    return ((h/24)|0)+'d ago';
  };

  const announce = (msg,important=false)=>{
    const node=important?liveAssert:live;
    node.textContent='';
    setTimeout(()=>{node.textContent=msg;},20);
  };

  const escapeHTML = str => str
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');

  const highlightMatch = text =>{
    const safe = escapeHTML(text);
    if(!query) return safe;
    const escQ = query.replace(/[.*+?^${}()|[\\]\\\\]/g,'\\\\$&');
    return safe.replace(new RegExp('('+escQ+')','ig'),'<span class="highlight">$1</span>');
  };

  function cloneDataset(type){
    return DATASETS[type].map(s=>({...s}));
  }

  async function loadDataset(type){
    loading = true;
    drawSkeleton();
    await new Promise(r=>setTimeout(r,180));
    services = cloneDataset(type);
    baseline = services.map(s=>({id:s.id, active:s.active}));
    loading = false;
  }

  function hasChanges(){
    return services.some(s=>{
      const b = baseline.find(x=>x.id===s.id);
      return !b || b.active !== s.active;
    });
  }

  function updateChangeUI(){
    const admin = role === 'Admin';
    changesBar.hidden = !admin;
    if(!admin){ return; }
    const changed = hasChanges();
    submitBtn.disabled = !changed;
    submitBtn.setAttribute('aria-disabled', submitBtn.disabled);
  }

  const ICONS = {
    check:'<svg viewBox="0 0 16 16" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M3 8.5 6.5 12 13 4"/></svg>',
    cross:'<svg viewBox="0 0 16 16" aria-hidden="true"><path fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" d="M3 3l10 10M13 3 3 13"/></svg>',
    up:'<svg viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" d="M7.24 3.3 2.2 10.6c-.46.66 0 1.4.82 1.4h9.96c.82 0 1.28-.74.82-1.4L8.76 3.3a1 1 0 0 0-1.52 0Z"/></svg>',
    tenant:'<svg viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" d="M2 2h12v12H2z" opacity=".35"/><path fill="currentColor" d="M4 4h2v2H4zm0 3h2v2H4zm0 3h2v2H4zm3-6h2v2H7zm0 3h2v2H7zm0 3h2v2H7zm3-6h2v2h-2zm0 3h2v2h-2z"/></svg>',
    account:'<svg viewBox="0 0 16 16" aria-hidden="true"><circle cx="8" cy="5" r="3" fill="currentColor"/><path fill="currentColor" d="M2.5 13.5c0-3 2.4-5 5.5-5s5.5 2 5.5 5v.5h-11z" opacity=".85"/></svg>'
  };

  const statusPill = active =>{
    const cls=active?'active':'inactive';
    const icon=active?ICONS.check:ICONS.cross;
    const label=active?'Active':'Inactive';
    return `<span class="pill status-pill ${cls}" aria-label="Status ${label}">${icon}<span class="txt">${label}</span></span>`;
  };
  const deployBadge = d =>{
    if(!d) return `<span class="pill deploy-badge empty" aria-label="Deployment status: No data">—</span>`;
    const ok=d==='Successful';
    const icon=ok?ICONS.up:ICONS.cross;
    const cls=ok?'success':'fail';
    return `<span class="pill deploy-badge ${cls}" aria-label="Deployment status: ${d}">${icon}<span class="txt">${d}</span></span>`;
  };
  const levelBadge = l =>{
    const icon=l==='tenant'?ICONS.tenant:ICONS.account;
    const cls=l==='tenant'?'tenant':'account';
    const label=l==='tenant'?'Tenant':'Account';
    return `<span class="pill level-badge ${cls}" aria-label="Level ${label}">${icon}<span class="txt">${label}</span></span>`;
  };

  function sortServices(list){
    switch(sortMode){
      case 'name-asc': return list.sort((a,b)=>a.name.localeCompare(b.name));
      case 'name-desc':return list.sort((a,b)=>b.name.localeCompare(a.name));
      case 'status-active-first': return list.sort((a,b)=>(b.active - a.active)||a.name.localeCompare(b.name));
      case 'updated-desc': return list.sort((a,b)=>b.updated - a.updated);
      case 'updated-asc': return list.sort((a,b)=>a.updated - b.updated);
      default: return list;
    }
  }

  const filtered = () => {
    let list = services.filter(s=>{
      const qOk = !query || s.name.toLowerCase().includes(query) || s.desc.toLowerCase().includes(query);
      const stOk = statusSel==='all' || (statusSel==='active'?s.active:!s.active);
      return qOk && stOk;
    });
    return sortServices(list);
  };

  function updateCounts(list){
    const total=services.length;
    const act=services.filter(s=>s.active).length;
    countTotal.textContent=list.length+'/'+total;
    countActive.textContent='Active:'+act;
    countInactive.textContent='Inactive:'+(total-act);
    summaryBar.innerHTML = `<strong>${list.length}</strong> visible of <strong>${total}</strong> • Active <strong>${act}</strong> • Inactive <strong>${total-act}</strong> • Sort: <code>${sortSelect.options[sortSelect.selectedIndex].text}</code>`;
  }

  function enableColumnAllowed(){
    return role==='Admin' && ENABLE_OK_TYPES.has(tenantType);
  }

  function buildItemHTML(s){
    const includeEnable = enableColumnAllowed();
    const canEditEnable = includeEnable && launchpadActive;
    const checked = s.active?'checked':'';
    const disabledAttr = canEditEnable?'':'disabled';
    const ariaDis = canEditEnable?'false':'true';
    const enableCell = includeEnable ? `
        <div class="enable-cell">
          <label class="mini-switch">
            <input type="checkbox"
                   role="switch"
                   data-act="toggle"
                   data-id="${s.id}"
                   ${checked}
                   ${disabledAttr}
                   aria-disabled="${ariaDis}"
                   aria-label="Enable ${escapeHTML(s.name)}"
                   aria-checked="${s.active}">
            <span></span>
          </label>
        </div>` : '';
    const showLastRun = s.deployment === 'Successful' || s.deployment === 'Failed';
    return `
      <li class="item fade-in" data-id="${s.id}">
        <div>
          <h3 class="item-title" id="svc-${s.id}">${highlightMatch(s.name)}</h3>
            <p class="item-desc">${highlightMatch(s.desc)}</p>
            <p class="item-meta">
              <span class="inline-updated" aria-label="Updated ${rel(s.updated)}">Updated ${rel(s.updated)}</span>
              <span class="tag-badge">${s.active?'active':'inactive'}</span>
            </p>
        </div>
        <div>${statusPill(s.active)}</div>
        <div class="deploy-cell">
          ${deployBadge(s.deployment)}
          ${showLastRun ? `<div class="deploy-last-run">
            <time datetime="${new Date(s.lastRun).toISOString()}" aria-label="Last run ${rel(s.lastRun)}">Last Run: ${rel(s.lastRun)}</time>
          </div>` : ``}
        </div>
        <div>${levelBadge(s.level)}</div>
        ${enableCell}
      </li>`;
  }

  function renderActiveFilters(){
    const chips=[];
    if(query) chips.push(`<span class="filter-chip" data-chip="q">Query: "${escapeHTML(query)}" <button aria-label="Clear search query" data-clear="q">×</button></span>`);
    if(statusSel!=='all') chips.push(`<span class="filter-chip" data-chip="status">Status: ${statusSel} <button aria-label="Clear status filter" data-clear="status">×</button></span>`);
    if(sortMode!=='name-asc') chips.push(`<span class="filter-chip" data-chip="sort">Sort: ${sortSelect.options[sortSelect.selectedIndex].text} <button aria-label="Reset sort" data-clear="sort">×</button></span>`);
    activeFiltersEl.innerHTML=chips.join('');
    activeFiltersEl.hidden=!chips.length;
  }

  function drawSkeleton(){
    listEl.innerHTML = '';
    emptyHint.hidden = true;
    for(let i=0;i<6;i++){
      const sk = document.createElement('li');
      sk.className='skeleton';
      sk.setAttribute('aria-hidden','true');
      sk.innerHTML=`<div class="skel-row">
        <div><div class="skel-bar" style="width:${40+Math.random()*40}%"></div><div class="skel-bar" style="width:${30+Math.random()*50}%"></div></div>
        <div class="skel-pill"></div>
        <div class="skel-pill" style="width:90px"></div>
        <div class="skel-pill" style="width:70px"></div>
        <div class="skel-pill" style="width:55px"></div>
      </div>`;
      listEl.appendChild(sk);
    }
  }

  function render(){
    if(loading){ drawSkeleton(); return; }
    if(renderQueued) renderQueued=false;
    const activeEl=document.activeElement;
    let focusServiceId=null;
    if(activeEl && activeEl.dataset && activeEl.dataset.id) focusServiceId=activeEl.dataset.id;
    else if(activeEl && activeEl.closest && activeEl.closest('.item')){
      const inp=activeEl.closest('.item').querySelector('input[data-act="toggle"]');
      if(inp) focusServiceId=inp.dataset.id;
    }
    document.body.classList.toggle('show-enable-column', enableColumnAllowed());
    listEl.innerHTML='';
    const list=filtered();
    if(!list.length){
      emptyHint.hidden=false;
    }else{
      emptyHint.hidden=true;
      listEl.innerHTML=list.map(buildItemHTML).join('');
    }
    updateCounts(list);
    renderActiveFilters();
    updateChangeUI();
    const changed=query || statusSel!=='all' || sortMode!=='name-asc';
    clearBtn.disabled = !(query || statusSel!=='all');
    resetBtn.disabled = !changed;
    if(focusServiceId){
      const candidate=listEl.querySelector(`input[data-id="${focusServiceId}"]`);
      if(candidate && !candidate.disabled){
        candidate.focus();
      }
    }
  }

  function queueRender(){
    if(renderQueued) return;
    renderQueued=true;
    requestAnimationFrame(render);
  }

  function setStatusFromToggle(svc,on){
    if(svc.active===on) return;
    svc.active=on;
    svc.updated=now();
    announce(`${svc.name} ${on?'enabled':'disabled'}`);
  }

  function updateStatusHint(){
    if(role!=='Admin'){
      statusHint.textContent='Read Only: Enable column hidden.';
      return;
    }
    if(!ENABLE_OK_TYPES.has(tenantType)){
      statusHint.textContent=`Admin: Enable column hidden for ${tenantType}.`;
      return;
    }
    statusHint.textContent = launchpadActive
      ? `Admin (${tenantType}) toggles active.`
      : `Admin (${tenantType}) layout disabled (toggles frozen).`;
  }

  function confirmDiscard(){
    return !hasChanges() || confirm('Discard unsaved staged changes?');
  }

  listEl.addEventListener('change',e=>{
    if(!enableColumnAllowed() || !launchpadActive) return;
    const input=e.target.closest('input[data-act="toggle"]');
    if(!input) return;
    const id=+input.dataset.id;
    const svc=services.find(s=>s.id===id);
    if(!svc) return;
    setStatusFromToggle(svc,input.checked);
    input.setAttribute('aria-checked', String(input.checked));
    updateChangeUI();
    queueRender();
  });

  listEl.addEventListener('keydown',e=>{
    if(!enableColumnAllowed() || !launchpadActive) return;
    if(e.key==='Enter'||e.key===' '){
      const input=e.target.matches('input[data-act="toggle"]')?e.target:e.target.querySelector('input[data-act="toggle"]');
      if(input && !input.disabled){
        e.preventDefault();
        input.checked=!input.checked;
        input.dispatchEvent(new Event('change',{bubbles:true}));
      }
    }
  });

  statusToggle.addEventListener('change',()=>{
    launchpadActive=statusToggle.checked;
    saveLS(LS_KEYS.layout,String(launchpadActive));
    const enabled=launchpadActive;
    statusLabel.classList.toggle('enabled',enabled);
    statusLabel.classList.toggle('disabled',!enabled);
    statusLabel.innerHTML=enabled?'<span class="icon" aria-hidden="true">✓</span>Enabled':'<span class="icon" aria-hidden="true">✕</span>Disabled';
    document.body.classList.toggle('launchpad-disabled',!enabled);
    updateStatusHint();
    announce('Layout '+(enabled?'enabled':'disabled'),true);
    queueRender();
  });

  roleSelect.addEventListener('change',async ()=>{
    if(!confirmDiscard()){ roleSelect.value=role; return; }
    role=roleSelect.value;
    saveLS(LS_KEYS.role,role);
    updateStatusHint();
    announce('Role '+role,true);
    updateChangeUI();
    queueRender();
  });

  tenantTypeSelect.addEventListener('change',async ()=>{
    if(!confirmDiscard()){ tenantTypeSelect.value=tenantType; return; }
    tenantType=tenantTypeSelect.value;
    saveLS(LS_KEYS.tenant,tenantType);
    await loadDataset(tenantType);
    announce('Tenant '+tenantType,true);
    updateStatusHint();
    updateChangeUI();
    queueRender();
  });

  function applyFilterState(){
    query=searchBox.value.trim().toLowerCase();
    statusSel=statusFilter.value;
    sortMode=sortSelect.value;
    saveLS(LS_KEYS.query,query);
    saveLS(LS_KEYS.status,statusSel);
    saveLS(LS_KEYS.sort,sortMode);
    queueRender();
  }

  let typeTimer;
  searchBox.addEventListener('input',()=>{
    clearTimeout(typeTimer);
    typeTimer=setTimeout(applyFilterState,160);
  });
  statusFilter.addEventListener('change',applyFilterState);
  sortSelect.addEventListener('change',applyFilterState);

  clearBtn.addEventListener('click',()=>{
    searchBox.value='';
    statusFilter.value='all';
    applyFilterState();
    searchBox.focus();
  });

  resetBtn.addEventListener('click',()=>{
    searchBox.value='';
    statusFilter.value='all';
    sortSelect.value='name-asc';
    applyFilterState();
  });

  activeFiltersEl.addEventListener('click',e=>{
    const btn=e.target.closest('button[data-clear]');
    if(!btn) return;
    const type=btn.dataset.clear;
    if(type==='q') searchBox.value='';
    if(type==='status') statusFilter.value='all';
    if(type==='sort') sortSelect.value='name-asc';
    applyFilterState();
  });

  submitBtn.addEventListener('click',()=>{
    if(submitBtn.disabled) return;
    baseline = services.map(s=>({id:s.id, active:s.active}));
    announce('Changes submitted', true);
    updateChangeUI();
  });

  document.addEventListener('keydown',e=>{
    if(e.key==='/' || e.key==='f'){
      if(document.activeElement!==searchBox && !e.metaKey && !e.ctrlKey){
        e.preventDefault();
        searchBox.focus();
        searchBox.select();
      }
    }
    if(e.key==='Escape'){
      if(searchBox===document.activeElement && searchBox.value){
        searchBox.value='';
        applyFilterState();
      }
    }
    if((e.metaKey||e.ctrlKey) && e.key==='Enter'){
      if(!submitBtn.disabled) submitBtn.click();
    }
  });

  (async ()=>{
    await loadDataset(tenantType);
    updateStatusHint();
    searchBox.value = query;
    updateChangeUI();
    render();
  })();
  // ...existing code...
})();
</script>
</body>
</html>